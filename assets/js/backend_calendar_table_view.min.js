window.BackendCalendarTableView=window.BackendCalendarTableView||{},function(e){"use strict";var a,t,n;function r(e,a){$("#calendar .calendar-header .btn").addClass("disabled").prop("disabled",!0);var t={};$(".provider-column").each((function(e,a){var n=$(a),r=n.data("provider").id;t[r]=n.find(".calendar-wrapper").fullCalendar("getView").name})),$("#calendar .calendar-view").remove(),Backend.placeFooterToBottom();var n=$("<div/>",{class:"calendar-view"}).appendTo("#calendar");n.data({startDate:e.toString("yyyy-MM-dd"),endDate:a.toString("yyyy-MM-dd")});var r=$("<div/>").appendTo(n);g(e,a).done((function(n){for(var s=e;s<=a;)i(r,s,n),s.add({days:1});v(),Backend.placeFooterToBottom(),$("#calendar .calendar-header .btn").removeClass("disabled").prop("disabled",!1),$(".provider-column").each((function(e,a){var n=$(a),r=n.data("provider").id;n.find(".calendar-wrapper").fullCalendar("changeView",t[r]||"agendaDay")}))}))}function i(e,n,r){var i=$("<div/>",{class:"date-column"}).appendTo(e);i.data("date",n.getTime()),$("<h5/>",{class:"date-column-title",text:GeneralFunctions.formatDate(n,GlobalVariables.dateFormat)}).appendTo(i);var p=a.val(),m=t.val(),v=GlobalVariables.availableProviders.filter((function(e){var a=e.services.filter((function(e){return m.filter((function(a){return Number(e)===Number(a)})).length}));return!p.length&&!m.length||p.length&&!m.length&&-1!==p.indexOf(e.id)||!p.length&&m.length&&a.length||p.length&&m.length&&a.length&&-1!==p.indexOf(e.id)}));"provider"===GlobalVariables.user.role_slug&&GlobalVariables.availableProviders.forEach((function(e){Number(e.id)===Number(GlobalVariables.user.id)&&(v=[e])})),"secretary"===GlobalVariables.user.role_slug&&(v=[],GlobalVariables.availableProviders.forEach((function(e){GlobalVariables.secretaryProviders.indexOf(e.id)>-1&&v.push(e)}))),v.forEach((function(e){!function(e,a,t,n){if(0===t.services.length)return;var r=$("<div/>",{class:"provider-column"}).appendTo(e);r.data("provider",t),function(e,a,t){var n=$("<div/>",{class:"calendar-wrapper"}).appendTo(e),r="";switch(GlobalVariables.dateFormat){case"DMY":r="ddd D/M";break;case"MDY":case"YMD":r="ddd M/D";break;default:throw new Error("Invalid date format setting provided!",GlobalVariables.dateFormat)}var i="",d="";switch(GlobalVariables.timeFormat){case"military":i="H:mm",d="H(:mm)";break;case"regular":i="h:mm a",d="h(:mm) a";break;default:throw new Error("Invalid time format setting provided!"+GlobalVariables.timeFormat)}var l=GlobalVariables.firstWeekday,c=GeneralFunctions.getWeekDayId(l);n.fullCalendar({defaultView:"agendaDay",height:s(),editable:!0,timeFormat:i,slotLabelFormat:d,allDaySlot:!0,columnFormat:r,firstDay:c,snapDuration:"00:15:00",header:{left:"listDay,agendaDay",center:"",right:""},selectable:!0,selectHelper:!0,select:function(e,a,t){if(e.hasTime()&&a.hasTime()){$("#insert-appointment").trigger("click");var n=$(t.target).parents(".provider-column").data("provider").id,r=GlobalVariables.availableProviders.find((function(e){return Number(e.id)===Number(n)})),i=GlobalVariables.availableServices.find((function(e){return-1!==r.services.indexOf(e.id)}));return i&&$("#select-service").val(i.id),$("#select-service").val()||$("#select-service option:first").prop("selected",!0),$("#select-service").trigger("change"),r&&$("#select-provider").val(r.id),$("#select-provider").val()||$("#select-provider option:first").prop("selected",!0),$("#select-provider").trigger("change"),$("#start-datetime").datepicker("setDate",new Date(e.format("YYYY/MM/DD HH:mm:ss"))),$("#end-datetime").datepicker("setDate",new Date(a.format("YYYY/MM/DD HH:mm:ss"))),!1}},monthNames:[EALang.january,EALang.february,EALang.march,EALang.april,EALang.may,EALang.june,EALang.july,EALang.august,EALang.september,EALang.october,EALang.november,EALang.december],monthNamesShort:[EALang.january.substr(0,3),EALang.february.substr(0,3),EALang.march.substr(0,3),EALang.april.substr(0,3),EALang.may.substr(0,3),EALang.june.substr(0,3),EALang.july.substr(0,3),EALang.august.substr(0,3),EALang.september.substr(0,3),EALang.october.substr(0,3),EALang.november.substr(0,3),EALang.december.substr(0,3)],dayNames:[EALang.sunday,EALang.monday,EALang.tuesday,EALang.wednesday,EALang.thursday,EALang.friday,EALang.saturday],dayNamesShort:[EALang.sunday.substr(0,3),EALang.monday.substr(0,3),EALang.tuesday.substr(0,3),EALang.wednesday.substr(0,3),EALang.thursday.substr(0,3),EALang.friday.substr(0,3),EALang.saturday.substr(0,3)],dayNamesMin:[EALang.sunday.substr(0,2),EALang.monday.substr(0,2),EALang.tuesday.substr(0,2),EALang.wednesday.substr(0,2),EALang.thursday.substr(0,2),EALang.friday.substr(0,2),EALang.saturday.substr(0,2)],buttonText:{today:EALang.today,day:EALang.day,week:EALang.week,month:EALang.month,agendaDay:EALang.calendar,listDay:EALang.list},eventClick:u,eventResize:f,eventDrop:b,viewRender:o}),n.fullCalendar("gotoDate",moment(a)),$("<h6/>",{text:t.first_name+" "+t.last_name}).prependTo(e)}(r,a,t),d(r.find(".calendar-wrapper"),t),l(r,n.appointments),c(r,n.unavailability_events),Backend.placeFooterToBottom()}(i,n,e,r)}))}function s(){var e=window.innerHeight-$("#footer").outerHeight()-$("#header").outerHeight()-60;return e>500?e:500}function o(e,a){$(a).fullCalendar("option","height",s())}function d(e,a){var t=JSON.parse(a.settings.working_plan),n=JSON.parse(a.settings.working_plan_exceptions)||{},r=e.fullCalendar("getView"),i=r.start.clone(),s=r.end.clone(),o=i.toDate().toString("dddd").toLowerCase(),d=i.format("YYYY-MM-DD"),l=[];if(n[d]){t[o]=n[d];var c=d+" "+t[o].start,p=d+" "+t[o].end,m={title:EALang.working_plan_exception,start:moment(c,"YYYY-MM-DD HH:mm",!0),end:moment(p,"YYYY-MM-DD HH:mm",!0).add(1,"day"),allDay:!0,color:"#879DB4",editable:!1,className:"fc-working-plan-exception fc-custom",data:{date:d,workingPlanException:n[d],provider:a}};l.push(m)}if(null===t[o]){var u={title:EALang.not_working,start:i,end:s,allDay:!1,color:"#BEBEBE",editable:!1,className:"fc-unavailable"};return l.push(u),void e.fullCalendar("addEventSource",l)}var f=moment(i.toDate().toString("yyyy-MM-dd")+" "+t[o].start);i<f&&(y={title:EALang.not_working,start:i,end:f,allDay:!1,color:"#BEBEBE",editable:!1,className:"fc-unavailable"},l.push(y));var b,v,g=moment(i.toDate().toString("yyyy-MM-dd")+" "+t[o].end);if(s>g){var y={title:EALang.not_working,start:g,end:s,allDay:!1,color:"#BEBEBE",editable:!1,className:"fc-unavailable"};l.push(y)}t[o].breaks.forEach((function(e){b=moment(i.toDate().toString("yyyy-MM-dd")+" "+e.start),v=moment(i.toDate().toString("yyyy-MM-dd")+" "+e.end);var a={title:EALang.break,start:b,end:v,allDay:!1,color:"#BEBEBE",editable:!1,className:"fc-unavailable fc-break"};l.push(a)})),e.fullCalendar("addEventSource",l)}function l(e,a){if(0!==a.length){var n=t.val();a=a.filter((function(e){return!n.length||-1!==n.indexOf(e.id_services)}));var r=[];for(var i in a){var s=a[i];s.id_users_provider===e.data("provider").id&&r.push({id:s.id,title:s.customer.first_name+" "+s.customer.last_name,start:moment(s.start_datetime),end:moment(s.end_datetime),allDay:!1,data:s})}e.find(".calendar-wrapper").fullCalendar("addEventSource",r)}}function c(e,a){if(0!==a.length){var t=[];for(var n in a){var r=a[n];if(r.id_users_provider===e.data("provider").id){var i={title:EALang.unavailable,start:moment(r.start_datetime),end:moment(r.end_datetime),allDay:!1,color:"#879DB4",editable:!0,className:"fc-unavailable fc-custom",data:r};t.push(i)}}e.find(".calendar-wrapper").fullCalendar("addEventSource",t)}}function p(e,a){if(0!==a.length){var t=new Date(e.parents(".date-column").data("date")),n=e.find("table tbody");for(var r in a){var i=a[r],s=i.start.split(":"),o=new Date(t.getFullYear(),t.getMonth(),t.getDate(),s[0],s[1]),d=i.end.split(":"),l=new Date(t.getFullYear(),t.getMonth(),t.getDate(),d[0],d[1]),c=Math.round((l-o)/6e4),p=$("<div/>",{class:"event unavailability break"});p.html(EALang.break+' <span class="hour">'+o.toString("HH:mm")+"</span> ("+c+"')"),p.data(i),n.find("tr").each((function(e,a){var n=$(a).find("td:first"),r=new Date(t.getTime()).set({hour:parseInt(n.text().split(":")[0]),minute:parseInt(n.text().split(":")[1])});if(o<r)return o.toString("HH:mm")===$(a).prev().find("td").eq(0).text()&&p.find(".hour").remove(),$(a).prev().find("td:gt(0)").each((function(e,a){p.clone().appendTo($(a))})),!1}))}}}function m(e){if(!e.data||!e.data.notes)return"-";var a=e.data.notes;return a.length>100?a.substring(0,100)+"...":a}function u(e,a){var t,r,i;$(".popover").popover("dispose");var s=$(a.target.offsetParent),o=$(a.target).parents().eq(1);if($(this).hasClass("fc-unavailable")||s.hasClass("fc-unavailable")||o.hasClass("fc-unavailable"))r=(s.hasClass("fc-custom")||o.hasClass("fc-custom"))&&!0===GlobalVariables.user.privileges.appointments.edit?"":"d-none",i=(s.hasClass("fc-custom")||o.hasClass("fc-custom"))&&!0===GlobalVariables.user.privileges.appointments.delete?"":"d-none",t=$("<div/>",{html:[$("<strong/>",{text:EALang.start}),$("<span/>",{text:GeneralFunctions.formatDate(e.start.format("YYYY-MM-DD HH:mm:ss"),GlobalVariables.dateFormat,!0)}),$("<br/>"),$("<strong/>",{text:EALang.end}),$("<span/>",{text:GeneralFunctions.formatDate(e.end.format("YYYY-MM-DD HH:mm:ss"),GlobalVariables.dateFormat,!0)}),$("<br/>"),$("<strong/>",{text:EALang.notes}),$("<span/>",{text:m(e)}),$("<br/>"),$("<hr/>"),$("<div/>",{class:"d-flex justify-content-center",html:[$("<button/>",{class:"close-popover btn btn-outline-secondary mr-2",html:[$("<i/>",{class:"fas fa-ban mr-2"}),$("<span/>",{text:EALang.close})]}),$("<button/>",{class:"delete-popover btn btn-outline-secondary mr-2 "+i,html:[$("<i/>",{class:"fas fa-trash-alt mr-2"}),$("<span/>",{text:EALang.delete})]}),$("<button/>",{class:"edit-popover btn btn-primary "+r,html:[$("<i/>",{class:"fas fa-edit mr-2"}),$("<span/>",{text:EALang.edit})]})]})]});else if($(this).hasClass("fc-working-plan-exception")||s.hasClass("fc-working-plan-exception")||o.hasClass("fc-working-plan-exception"))r=(s.hasClass("fc-custom")||o.hasClass("fc-custom"))&&!0===GlobalVariables.user.privileges.appointments.edit?"":"d-none",i=(s.hasClass("fc-custom")||o.hasClass("fc-custom"))&&!0===GlobalVariables.user.privileges.appointments.delete?"":"d-none",t=$("<div/>",{html:[$("<strong/>",{text:EALang.provider}),$("<span/>",{text:e.data?e.data.provider.first_name+" "+e.data.provider.last_name:"-"}),$("<br/>"),$("<strong/>",{text:EALang.start}),$("<span/>",{text:GeneralFunctions.formatDate(e.data.date+" "+e.data.workingPlanException.start,GlobalVariables.dateFormat,!0)}),$("<br/>"),$("<strong/>",{text:EALang.end}),$("<span/>",{text:GeneralFunctions.formatDate(e.data.date+" "+e.data.workingPlanException.end,GlobalVariables.dateFormat,!0)}),$("<br/>"),$("<strong/>",{text:EALang.timezone}),$("<span/>",{text:GlobalVariables.timezones[e.data.provider.timezone]}),$("<br/>"),$("<hr/>"),$("<div/>",{class:"d-flex justify-content-center",html:[$("<button/>",{class:"close-popover btn btn-outline-secondary mr-2",html:[$("<i/>",{class:"fas fa-ban mr-2"}),$("<span/>",{text:EALang.close})]}),$("<button/>",{class:"delete-popover btn btn-outline-secondary mr-2 "+i,html:[$("<i/>",{class:"fas fa-trash-alt mr-2"}),$("<span/>",{text:EALang.delete})]}),$("<button/>",{class:"edit-popover btn btn-primary "+r,html:[$("<i/>",{class:"fas fa-edit mr-2"}),$("<span/>",{text:EALang.edit})]})]})]});else{r=!0===GlobalVariables.user.privileges.appointments.edit?"":"d-none",i=!0===GlobalVariables.user.privileges.appointments.delete?"":"d-none";let a={CANADA:"IME/UCCI #",AUSTRALIA:"HAP ID","NEW ZEALAND":"NZER/NZHR"};t=$("<div/>",{html:[$("<strong/>",{text:EALang.start}),$("<span/>",{text:GeneralFunctions.formatDate(e.start.format("YYYY-MM-DD HH:mm:ss"),GlobalVariables.dateFormat,!0)}),$("<br/>"),$("<strong/>",{text:EALang.end}),$("<span/>",{text:GeneralFunctions.formatDate(e.end.format("YYYY-MM-DD HH:mm:ss"),GlobalVariables.dateFormat,!0)}),$("<br/>"),$("<strong/>",{text:EALang.timezone}),$("<span/>",{text:GlobalVariables.timezones[e.data.provider.timezone]}),$("<br/>"),$("<strong/>",{text:EALang.service}),$("<span/>",{text:e.data.service.name}),$("<br/>"),$("<strong/>",{text:EALang.provider}),GeneralFunctions.renderMapIcon(e.data.provider),$("<span/>",{text:e.data.provider.first_name+" "+e.data.provider.last_name}),$("<br/>"),$("<strong/>",{text:EALang.customer}),GeneralFunctions.renderMapIcon(e.data.customer),$("<span/>",{text:e.data.customer.first_name+" "+e.data.customer.last_name}),$("<br/>"),$("<strong/>",{text:EALang.email}),GeneralFunctions.renderMailIcon(e.data.customer.email),$("<span/>",{text:e.data.customer.email}),$("<br/>"),$("<strong/>",{text:EALang.phone}),GeneralFunctions.renderPhoneIcon(e.data.customer.phone_number),$("<span/>",{text:e.data.customer.phone_number}),$("<br/>"),$("<strong/>",{text:EALang.notes}),$("<span/>",{text:m(e)}),$("<hr/>"),$("<div/>",{class:""==e.data.created_by||null==e.data.created_by?"d-none":"form-group row pl-3 mb-0",html:[$("<b/>",{class:"col-sm-6 col-form-label p-0",text:"Appointment created by"}),$("<div/>",{class:"col p-0",text:e.data.created_by})]}),$("<div/>",{class:"form-group row pl-3 mb-0",html:[$("<b/>",{class:"col-sm-6 col-form-label p-0",text:"Sex"}),$("<div/>",{class:"col p-0",text:e.data.customer.sex})]}),$("<div/>",{class:"form-group row pl-3 mb-0",html:[$("<b/>",{class:"col-sm-6 col-form-label p-0",text:"Birth Date"}),$("<div/>",{class:"col p-0",text:e.data.customer.birth_date})]}),$("<div/>",{class:"form-group row pl-3 mb-0",html:[$("<b/>",{class:"col-sm-6 col-form-label p-0",text:"Passport Number"}),$("<div/>",{class:"col p-0",text:e.data.customer.passport_number})]}),$("<div/>",{class:"form-group row pl-3 mb-0",html:[$("<b/>",{class:"col-sm-6 col-form-label p-0",text:"Passport Expiry Date"}),$("<div/>",{class:"col p-0",text:e.data.customer.passport_expiry_date})]}),$("<div/>",{class:"Not Applicable"==e.data.customer.applicant_type||null==e.data.customer.applicant_type?"d-none":"form-group row pl-3 mb-0",html:[$("<b/>",{class:"col-sm-6 col-form-label p-0",text:"Applicant Type"}),$("<div/>",{class:"col p-0",text:e.data.customer.applicant_type})]}),$("<div/>",{class:"Not Applicable"==e.data.customer.applicant_type||null==e.data.customer.applicant_type?"d-none":"form-group row pl-3 mb-0",html:[$("<b/>",{class:"col-sm-6 col-form-label  p-0",text:a[e.data.customer.applicant_type]}),$("<div/>",{class:"col p-0",text:e.data.customer.client_id_reference_number})]}),$("<div/>",{class:"Not Applicable"==e.data.customer.applicant_type||null==e.data.customer.applicant_type?"d-none":"form-group row pl-3 mb-0",html:[$("<b/>",{class:"col-sm-6 col-form-label  p-0",text:"Visa Type"}),$("<div/>",{class:"col p-0",text:e.data.customer.visa_type})]}),$("<div/>",{class:"Not Applicable"==e.data.customer.applicant_type||null==e.data.customer.applicant_type?"d-none":"form-group row pl-3 mb-0",html:[$("<b/>",{class:"col-sm-6 col-form-label  p-0",text:"Visa Category"}),$("<div/>",{class:"col p-0",text:e.data.customer.visa_category})]}),$("<button/>",{class:null==e.data.proof_of_payment?"d-none":"btn btn-sm btn-info mb-2",text:"View proof of payment",type:"button","data-toggle":"view-image-modal","data-href":GlobalVariables.baseUrl+"/storage/uploads/"+e.data.proof_of_payment,target:"_blank"}),$("<br/>"),$("<button/>",{class:null==e.data.proof_of_identity?"d-none":"btn btn-sm btn-info",text:"View proof of identity",type:"button","data-toggle":"view-image-modal","data-href":GlobalVariables.baseUrl+"/storage/uploads/"+e.data.proof_of_identity,target:"_blank"}),$("<hr/>"),$("<div/>",{class:"d-flex justify-content-center",html:[$("<button/>",{class:"close-popover btn btn-outline-secondary mr-2",html:[$("<i/>",{class:"fas fa-ban mr-2"}),$("<span/>",{text:EALang.close})]}),$("<button/>",{class:"delete-popover btn btn-outline-secondary mr-2 "+i,html:[$("<i/>",{class:"fas fa-trash-alt mr-2"}),$("<span/>",{text:EALang.delete})]}),$("<button/>",{class:"edit-popover btn btn-primary "+r,html:[$("<i/>",{class:"fas fa-edit mr-2"}),$("<span/>",{text:EALang.edit})]})]})]})}$(a.target).popover({placement:"top",title:e.title,content:t,html:!0,container:"#calendar",trigger:"manual"}),n=e,$(a.target).popover("toggle"),$(".popover").length>0&&$(".popover").position().top<200&&$(".popover").css("top","200px")}function f(e,a,t){if(!1===GlobalVariables.user.privileges.appointments.edit)return t(),void Backend.displayNotification(EALang.no_privileges_edit_appointments);var n,r=$("#calendar");if($("#notification").is(":visible")&&$("#notification").hide("bind"),"0"===e.data.is_unavailable){e.data.end_datetime=Date.parseExact(e.data.end_datetime,"yyyy-MM-dd HH:mm:ss").add({days:a.days(),hours:a.hours(),minutes:a.minutes()}).toString("yyyy-MM-dd HH:mm:ss");var i=GeneralFunctions.clone(e.data);delete i.customer,delete i.provider,delete i.service,n=function(){Backend.displayNotification(EALang.appointment_updated,[{label:EALang.undo,function:function(){i.end_datetime=e.data.end_datetime=Date.parseExact(i.end_datetime,"yyyy-MM-dd HH:mm:ss").add({days:-a.days(),hours:-a.hours(),minutes:-a.minutes()}).toString("yyyy-MM-dd HH:mm:ss");var n=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_save_appointment",r={csrfToken:GlobalVariables.csrfToken,appointment_data:JSON.stringify(i)};$.post(n,r).done((function(){$("#notification").hide("blind")})),t()}}]),$("#footer").css("position","static"),r.fullCalendar("updateEvent",e)},BackendCalendarApi.saveAppointment(i,null,n)}else{var s={id:e.data.id,start_datetime:e.start.format("YYYY-MM-DD HH:mm:ss"),end_datetime:e.end.format("YYYY-MM-DD HH:mm:ss"),id_users_provider:e.data.id_users_provider};e.data.end_datetime=s.end_datetime,n=function(){Backend.displayNotification(EALang.unavailable_updated,[{label:EALang.undo,function:function(){s.end_datetime=e.data.end_datetime=Date.parseExact(s.end_datetime,"yyyy-MM-dd HH:mm:ss").add({minutes:-a.minutes()}).toString("yyyy-MM-dd HH:mm:ss");var n=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_save_unavailable",r={csrfToken:GlobalVariables.csrfToken,unavailable:JSON.stringify(s)};$.post(n,r).done((function(){$("#notification").hide("blind")})),t()}}]),$("#footer").css("position","static"),r.fullCalendar("updateEvent",e)},BackendCalendarApi.saveUnavailable(s,n)}}function b(e,a,t){if(!1===GlobalVariables.user.privileges.appointments.edit)return t(),void Backend.displayNotification(EALang.no_privileges_edit_appointments);var n;if($("#notification").is(":visible")&&$("#notification").hide("bind"),"0"===e.data.is_unavailable){var r=GeneralFunctions.clone(e.data);delete r.customer,delete r.provider,delete r.service,r.start_datetime=Date.parseExact(r.start_datetime,"yyyy-MM-dd HH:mm:ss").add({days:a.days(),hours:a.hours(),minutes:a.minutes()}).toString("yyyy-MM-dd HH:mm:ss"),r.end_datetime=Date.parseExact(r.end_datetime,"yyyy-MM-dd HH:mm:ss").add({days:a.days(),hours:a.hours(),minutes:a.minutes()}).toString("yyyy-MM-dd HH:mm:ss"),e.data.start_datetime=r.start_datetime,e.data.end_datetime=r.end_datetime,n=function(){Backend.displayNotification(EALang.appointment_updated,[{label:EALang.undo,function:function(){r.start_datetime=Date.parseExact(r.start_datetime,"yyyy-MM-dd HH:mm:ss").add({days:-a.days(),hours:-a.hours(),minutes:-a.minutes()}).toString("yyyy-MM-dd HH:mm:ss"),r.end_datetime=Date.parseExact(r.end_datetime,"yyyy-MM-dd HH:mm:ss").add({days:-a.days(),hours:-a.hours(),minutes:-a.minutes()}).toString("yyyy-MM-dd HH:mm:ss"),e.data.start_datetime=r.start_datetime,e.data.end_datetime=r.end_datetime;var n=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_save_appointment",i={csrfToken:GlobalVariables.csrfToken,appointment_data:JSON.stringify(r)};$.post(n,i).done((function(){$("#notification").hide("blind")})),t()}}]),$("#footer").css("position","static")},BackendCalendarApi.saveAppointment(r,null,n)}else{var i={id:e.data.id,start_datetime:e.start.format("YYYY-MM-DD HH:mm:ss"),end_datetime:e.end.format("YYYY-MM-DD HH:mm:ss"),id_users_provider:e.data.id_users_provider};n=function(){Backend.displayNotification(EALang.unavailable_updated,[{label:EALang.undo,function:function(){i.start_datetime=Date.parseExact(i.start_datetime,"yyyy-MM-dd HH:mm:ss").add({days:-a.days(),minutes:-a.minutes()}).toString("yyyy-MM-dd HH:mm:ss"),i.end_datetime=Date.parseExact(i.end_datetime,"yyyy-MM-dd HH:mm:ss").add({days:-a.days(),minutes:-a.minutes()}).toString("yyyy-MM-dd HH:mm:ss"),e.data.start_datetime=i.start_datetime,e.data.end_datetime=i.end_datetime;var n=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_save_unavailable",r={csrfToken:GlobalVariables.csrfToken,unavailable:JSON.stringify(i)};$.post(n,r).done((function(){$("#notification").hide("blind")})),t()}}]),$("#footer").css("position","static")},BackendCalendarApi.saveUnavailable(i,n)}}function v(){var e=window.innerHeight-$("#header").outerHeight()-$("#footer").outerHeight()-$("#calendar-toolbar").outerHeight()-$(".calendar-header").outerHeight()-50;e<500&&(e=500);var a=$(".date-column"),t=$(".calendar-view > div");t.css("min-width","1000%");var n=0;a.each((function(e,a){n+=$(a).outerWidth()})),t.css("min-width",n+200);var r=a.outerHeight();$(".calendar-view .not-working").outerHeight((r>e?r:e)-70)}function g(e,a){var t=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_get_calendar_events",n={csrfToken:GlobalVariables.csrfToken,startDate:e.toString("yyyy-MM-dd"),endDate:a.toString("yyyy-MM-dd")};return $.ajax({url:t,data:n,method:"POST",beforeSend:function(){},complete:function(){}})}window.BackendCalendarTableView.initialize=function(){var e,i;!function(){$("#calendar-filter").find("select").empty().append(new Option("1 "+EALang.day,1)).append(new Option("3 "+EALang.days,3));var e,n=$("<div/>",{class:"calendar-header"}).appendTo("#calendar");switch($("<button/>",{class:"btn btn-xs btn-outline-secondary previous mr-2",html:[$("<span/>",{class:"fas fa-chevron-left"})]}).appendTo(n),$("<input/>",{type:"text",class:"form-control d-inline-block select-date mr-2",value:GeneralFunctions.formatDate(new Date,GlobalVariables.dateFormat,!1)}).appendTo(n),$("<button/>",{class:"btn btn-xs btn-outline-secondary next",html:[$("<span/>",{class:"fas fa-chevron-right"})]}).appendTo(n),GlobalVariables.dateFormat){case"DMY":e="dd/mm/yy";break;case"MDY":e="mm/dd/yy";break;case"YMD":e="yy/mm/dd";break;default:throw new Error("Invalid date format setting provided: "+GlobalVariables.dateFormat)}n.find(".select-date").datepicker({defaultDate:new Date,dateFormat:e,onSelect:function(e,a){var t=new Date(a.currentYear,a.currentMonth,a.currentDay),n=new Date(t.getTime()).add({days:parseInt($("#select-filter-item").val())-1});r(t,n)}});var i=GlobalVariables.availableProviders.filter((function(e){return GlobalVariables.user.role_slug===Backend.DB_SLUG_ADMIN||GlobalVariables.user.role_slug===Backend.DB_SLUG_SECRETARY&&-1!==GlobalVariables.secretaryProviders.indexOf(e.id)||GlobalVariables.user.role_slug===Backend.DB_SLUG_PROVIDER&&Number(e.id)===Number(GlobalVariables.user.id)}));$("<label/>",{text:EALang.provider}).appendTo(n),a=$("<select/>",{id:"filter-provider",multiple:"multiple",on:{change:function(){var e=new Date($(".calendar-view .date-column:first").data("date")),a=new Date(e.getTime()).add({days:parseInt($("#select-date").val())-1});r(e,a)}}}).appendTo(n),GlobalVariables.user.role_slug!==Backend.DB_SLUG_PROVIDER?i.forEach((function(e){a.append(new Option(e.first_name+" "+e.last_name,e.id))})):i.forEach((function(e){Number(e.id)===Number(GlobalVariables.user.id)&&a.append(new Option(e.first_name+" "+e.last_name,e.id))})),a.select2();var s=GlobalVariables.availableServices.filter((function(e){var a=i.find((function(a){return-1!==a.services.indexOf(e.id)}));return GlobalVariables.user.role_slug===Backend.DB_SLUG_ADMIN||a}));$("<label/>",{text:EALang.service}).appendTo(n),t=$("<select/>",{id:"filter-service",multiple:"multiple",on:{change:function(){var e=new Date($(".calendar-view .date-column:first").data("date")),a=new Date(e.getTime()).add({days:parseInt($("#select-date").val())-1});r(e,a)}}}).appendTo(n),s.forEach((function(e){t.append(new Option(e.name,e.id))})),t.select2()}(),r(moment().toDate(),moment().add(Number($("#select-filter-item").val())-1,"days").toDate()),$("#insert-working-plan-exception").hide(),e=$("#calendar-toolbar"),(i=$("#calendar")).on("click",".calendar-header .btn.previous",(function(){var e=$("#select-filter-item").val(),a=$(".select-date").datepicker("getDate"),t=moment(a).subtract(1,"days"),n=t.clone().add(e-1,"days");$(".select-date").datepicker("setDate",t.toDate()),r(t.toDate(),n.toDate())})),i.on("click",".calendar-header .btn.next",(function(){var e=$("#select-filter-item").val(),a=$(".select-date").datepicker("getDate"),t=moment(a).add(1,"days"),n=t.clone().add(e-1,"days");$(".select-date").datepicker("setDate",t.toDate()),r(t.toDate(),n.toDate())})),e.on("change","#select-filter-item",(function(){var e=$("#select-filter-item").val(),a=$(".select-date").datepicker("getDate"),t=moment(a),n=t.clone().add(e-1,"days");r(t.toDate(),n.toDate())})),e.on("click","#reload-appointments",(function(){$(".calendar-view .event").remove();var e=$("#select-filter-item").val(),a=$(".select-date").datepicker("getDate"),t=moment(a),n=t.toDate(),r=t.clone().add(e-1,"days").toDate();g(n,r).done((function(e){for(var a=n;a<=r;)$(".calendar-view .date-column").each((function(t,n){var r=$(n),i=new Date(r.data("date"));if(a.getTime()!==i.getTime())return!0;r.find(".date-column-title").text(GeneralFunctions.formatDate(i,GlobalVariables.dateFormat)),r.find(".provider-column").each((function(a,t){var n=$(t),r=n.data("provider");n.find(".calendar-wrapper").fullCalendar("removeEvents"),d(n.find(".calendar-wrapper"),n.data("provider")),l(n,e.appointments),c(n,e.unavailability_events);var s=JSON.parse(r.settings.working_plan),o=i.toString("dddd").toLowerCase();s[o]&&p(n,s[o].breaks)}))})),a.add({days:1});Backend.placeFooterToBottom()}))})),$(window).on("resize",(function(){v()})),i.on("click",".close-popover",(function(){$(this).parents(".popover").popover("dispose")})),i.on("click",".edit-popover",(function(){var e;if($(this).parents(".popover").popover("dispose"),n.data.workingPlanException){var a=n.data.date,t=n.data.workingPlanException,r=n.data.provider;WorkingPlanExceptionsModal.edit(a,t).done((function(e,a){BackendCalendarApi.saveWorkingPlanException(e,a,r.id,(function(){Backend.displayNotification(EALang.working_plan_exception_saved);var t=JSON.parse(r.settings.working_plan_exceptions)||{};for(var n in t[e]=a,GlobalVariables.availableProviders){var i=GlobalVariables.availableProviders[n];if(Number(i.id)===Number(r.id)){i.settings.working_plan_exceptions=JSON.stringify(t);break}}$("#select-filter-item").trigger("change")}),null)}))}else if("0"===n.data.is_unavailable){var i=n.data;e=$("#manage-appointment"),BackendCalendarAppointmentsModal.resetAppointmentDialog(),e.find(".modal-header h3").text(EALang.edit_appointment_title),e.find("#appointment-id").val(i.id),e.find("#select-service").val(i.id_services).trigger("change"),e.find("#select-provider").val(i.id_users_provider);var s=Date.parseExact(i.start_datetime,"yyyy-MM-dd HH:mm:ss");e.find("#start-datetime").datetimepicker("setDate",s);var o=Date.parseExact(i.end_datetime,"yyyy-MM-dd HH:mm:ss");e.find("#end-datetime").datetimepicker("setDate",o);var d=i.customer;e.find("#customer-id").val(i.id_users_customer),e.find("#first-name").val(d.first_name),e.find("#last-name").val(d.last_name),e.find("#email").val(d.email),e.find("#phone-number").val(d.phone_number),e.find("#address").val(d.address),e.find("#city").val(d.city),e.find("#zip-code").val(d.zip_code),e.find("#appointment-location").val(i.location),e.find("#appointment-notes").val(i.notes),e.find("#customer-notes").val(d.notes),e.find('input[name="sex"]').prop("checked",!1),e.find("#sex-"+d.sex).prop("checked",!0),e.find("#birth-date").val(d.birth_date),e.find("#passport-number").val(d.passport_number),e.find("#passport-expiry-date").val(d.passport_expiry_date);let a=d.applicant_type,t="ID #";switch(e.find(".client-id-reference-number-container").addClass("d-none"),e.find(".visa-category-container").addClass("d-none"),e.find(".visa-type-container").addClass("d-none"),e.find(".canada-applicants-info").addClass("d-none"),e.find(".australia-applicants-info").addClass("d-none"),e.find(".new-zealand-applicants-info").addClass("d-none"),a){case"CANADA":t="IME/UCCI #",e.find(".canada-applicants-info").removeClass("d-none"),e.find(".client-id-reference-number-container").removeClass("d-none"),e.find(".visa-category-container").removeClass("d-none"),e.find(".visa-type-container").removeClass("d-none");break;case"AUSTRALIA":t="HAP ID",e.find(".australia-applicants-info").removeClass("d-none"),e.find(".client-id-reference-number-container").removeClass("d-none");break;case"NEW ZEALAND":t="NZER/NZHR",e.find(".new-zealand-applicants-info").removeClass("d-none"),e.find(".client-id-reference-number-container").removeClass("d-none"),e.find(".visa-category-container").removeClass("d-none"),e.find(".visa-type-container").removeClass("d-none");break;default:e.find(".client-id-reference-number-container").addClass("d-none"),e.find(".visa-category-container").addClass("d-none"),e.find(".visa-type-container").addClass("d-none")}e.find('label[for="client-id-reference-number"]').text(t),e.find("#applicant-type").val(a),e.find("#client-id-reference-number").val(d.client_id_reference_number),e.find("#visa-category").val(d.visa_category),e.find("#visa-type").val(d.visa_type),e.modal("show")}else{var l=n.data;l.start_datetime=n.start.format("YYYY-MM-DD HH:mm:ss"),s=Date.parseExact(l.start_datetime,"yyyy-MM-dd HH:mm:ss"),l.end_datetime=n.end.format("YYYY-MM-DD HH:mm:ss"),o=Date.parseExact(l.end_datetime,"yyyy-MM-dd HH:mm:ss"),e=$("#manage-unavailable"),BackendCalendarUnavailabilityEventsModal.resetUnavailableDialog(),e.find(".modal-header h3").text("Edit Unavailable Period"),e.find("#unavailable-start").datetimepicker("setDate",s),e.find("#unavailable-id").val(l.id),e.find("#unavailable-provider").val(l.id_users_provider),e.find("#unavailable-end").datetimepicker("setDate",o),e.find("#unavailable-notes").val(l.notes),e.modal("show")}})),i.on("click",".delete-popover",(function(){var e,a;if($(this).parents(".popover").popover("dispose"),n.data.workingPlanException)e=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_delete_working_plan_exception",a={csrfToken:GlobalVariables.csrfToken,working_plan_exception:n.start.format("YYYY-MM-DD"),provider_id:n.data.provider.id},$.post(e,a).done((function(){$("#message-box").dialog("close");var e=JSON.parse(n.data.provider.settings.working_plan_exceptions);delete e[n.start.format("YYYY-MM-DD")],n.data.provider.settings.working_plan_exceptions=JSON.stringify(e),$("#select-filter-item").trigger("change")}));else if("0"===n.data.is_unavailable){var t=[{text:EALang.cancel,click:function(){$("#message-box").dialog("close")}},{text:"OK",click:function(){e=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_delete_appointment",a={csrfToken:GlobalVariables.csrfToken,appointment_id:n.data.id,delete_reason:$("#delete-reason").val()},$.post(e,a).done((function(){$("#message-box").dialog("close"),$("#select-filter-item").trigger("change")}))}}];GeneralFunctions.displayMessageBox(EALang.delete_appointment_title,EALang.write_appointment_removal_reason,t),$("<textarea/>",{class:"form-control w-100",id:"delete-reason",rows:"3"}).appendTo("#message-box")}else e=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_delete_unavailable",a={csrfToken:GlobalVariables.csrfToken,unavailable_id:n.data.id},$.post(e,a).done((function(){$("#message-box").dialog("close"),$("#select-filter-item").trigger("change")}))})),$("#enable-sync, #google-sync").hide()}}();