window.BackendCalendarDefaultView=window.BackendCalendarDefaultView||{},function(e){"use strict";var a,t="provider",n="service";function i(){var e=window.innerHeight-$("#footer").outerHeight()-$("#header").outerHeight()-$("#calendar-toolbar").outerHeight()-60;return e>500?e:500}function s(e){if(!e.data||!e.data.notes)return"-";var a=e.data.notes;return a.length>100?a.substring(0,100)+"...":a}function r(e,t){var n,i,r;$(".popover").popover("dispose");var l=$(t.target.offsetParent),o=$(t.target).parents().eq(1);if($(this).hasClass("fc-unavailable")||l.hasClass("fc-unavailable")||o.hasClass("fc-unavailable"))i=(l.hasClass("fc-custom")||o.hasClass("fc-custom"))&&!0===GlobalVariables.user.privileges.appointments.edit?"mr-2":"d-none",r=(l.hasClass("fc-custom")||o.hasClass("fc-custom"))&&!0===GlobalVariables.user.privileges.appointments.delete?"mr-2":"d-none",n=$("<div/>",{html:[$("<strong/>",{class:"d-inline-block mr-2",text:EALang.start}),$("<span/>",{text:GeneralFunctions.formatDate(e.start.format("YYYY-MM-DD HH:mm:ss"),GlobalVariables.dateFormat,!0)}),$("<br/>"),$("<strong/>",{class:"d-inline-block mr-2",text:EALang.end}),$("<span/>",{text:GeneralFunctions.formatDate(e.end.format("YYYY-MM-DD HH:mm:ss"),GlobalVariables.dateFormat,!0)}),$("<br/>"),$("<strong/>",{text:EALang.notes}),$("<span/>",{text:s(e)}),$("<br/>"),$("<hr/>"),$("<div/>",{class:"d-flex justify-content-center",html:[$("<button/>",{class:"close-popover btn btn-outline-secondary mr-2",html:[$("<i/>",{class:"fas fa-ban mr-2"}),$("<span/>",{text:EALang.close})]}),$("<button/>",{class:"delete-popover btn btn-outline-secondary "+r,html:[$("<i/>",{class:"fas fa-trash-alt mr-2"}),$("<span/>",{text:EALang.delete})]}),$("<button/>",{class:"edit-popover btn btn-primary "+i,html:[$("<i/>",{class:"fas fa-edit mr-2"}),$("<span/>",{text:EALang.edit})]})]})]});else if($(this).hasClass("fc-working-plan-exception")||l.hasClass("fc-working-plan-exception")||o.hasClass("fc-working-plan-exception"))r=(l.hasClass("fc-custom")||o.hasClass("fc-custom"))&&!0===GlobalVariables.user.privileges.appointments.delete?"mr-2":"d-none",n=$("<div/>",{html:[$("<strong/>",{class:"d-inline-block mr-2",text:EALang.provider}),$("<span/>",{text:e.data?e.data.provider.first_name+" "+e.data.provider.last_name:"-"}),$("<br/>"),$("<strong/>",{class:"d-inline-block mr-2",text:EALang.start}),$("<span/>",{text:GeneralFunctions.formatDate(e.data.date+" "+e.data.workingPlanException.start,GlobalVariables.dateFormat,!0)}),$("<br/>"),$("<strong/>",{class:"d-inline-block mr-2",text:EALang.end}),$("<span/>",{text:GeneralFunctions.formatDate(e.data.date+" "+e.data.workingPlanException.end,GlobalVariables.dateFormat,!0)}),$("<br/>"),$("<strong/>",{class:"d-inline-block mr-2",text:EALang.timezone}),$("<span/>",{text:GlobalVariables.timezones[e.data.provider.timezone]}),$("<br/>"),$("<hr/>"),$("<div/>",{class:"d-flex justify-content-between",html:[$("<button/>",{class:"close-popover btn btn-outline-secondary mr-2",html:[$("<i/>",{class:"fas fa-ban mr-2"}),$("<span/>",{text:EALang.close})]}),$("<button/>",{class:"delete-popover btn btn-outline-secondary "+r,html:[$("<i/>",{class:"fas fa-trash-alt mr-2"}),$("<span/>",{text:EALang.delete})]}),$("<button/>",{class:"edit-popover btn btn-primary "+i,html:[$("<i/>",{class:"fas fa-edit mr-2"}),$("<span/>",{text:EALang.edit})]})]})]});else{i=!0===GlobalVariables.user.privileges.appointments.edit?"mr-2":"d-none",r=!0===GlobalVariables.user.privileges.appointments.delete?"mr-2":"d-none";let a={CANADA:"IME/UCCI #",AUSTRALIA:"HAP ID","NEW ZEALAND":"NZER/NZHR"};n=$("<div/>",{html:[$("<strong/>",{class:"d-inline-block mr-2",text:EALang.start}),$("<span/>",{text:GeneralFunctions.formatDate(e.start.format("YYYY-MM-DD HH:mm:ss"),GlobalVariables.dateFormat,!0)}),$("<br/>"),$("<strong/>",{class:"d-inline-block mr-2",text:EALang.end}),$("<span/>",{text:GeneralFunctions.formatDate(e.end.format("YYYY-MM-DD HH:mm:ss"),GlobalVariables.dateFormat,!0)}),$("<br/>"),$("<strong/>",{class:"d-inline-block mr-2",text:EALang.timezone}),$("<span/>",{text:GlobalVariables.timezones[e.data.provider.timezone]}),$("<br/>"),$("<strong/>",{class:"d-inline-block mr-2",text:EALang.service}),$("<span/>",{text:e.data.service.name}),$("<br/>"),$("<strong/>",{class:"d-inline-block mr-2",text:EALang.provider}),GeneralFunctions.renderMapIcon(e.data.provider),$("<span/>",{text:e.data.provider.first_name+" "+e.data.provider.last_name}),$("<br/>"),$("<strong/>",{class:"d-inline-block mr-2",text:EALang.customer}),GeneralFunctions.renderMapIcon(e.data.customer),$("<span/>",{class:"d-inline-block ml-1",text:e.data.customer.first_name+" "+e.data.customer.last_name}),$("<br/>"),$("<strong/>",{class:"d-inline-block mr-2",text:EALang.email}),GeneralFunctions.renderMailIcon(e.data.customer.email),$("<span/>",{class:"d-inline-block ml-1",text:e.data.customer.email}),$("<br/>"),$("<strong/>",{class:"d-inline-block mr-2",text:EALang.phone}),GeneralFunctions.renderPhoneIcon(e.data.customer.phone_number),$("<span/>",{class:"d-inline-block ml-1",text:e.data.customer.phone_number}),$("<br/>"),$("<strong/>",{text:EALang.notes}),$("<span/>",{text:s(e)}),$("<hr/>"),$("<div/>",{class:""==e.data.created_by||null==e.data.created_by?"d-none":"form-group row pl-3 mb-0",html:[$("<b/>",{class:"col-sm-6 col-form-label p-0",text:"Appointment created by"}),$("<div/>",{class:"col p-0",text:e.data.created_by})]}),$("<div/>",{class:"form-group row pl-3 mb-0",html:[$("<b/>",{class:"col-sm-6 col-form-label p-0",text:"Sex"}),$("<div/>",{class:"col p-0",text:e.data.customer.sex})]}),$("<div/>",{class:"form-group row pl-3 mb-0",html:[$("<b/>",{class:"col-sm-6 col-form-label p-0",text:"Birth Date"}),$("<div/>",{class:"col p-0",text:e.data.customer.birth_date})]}),$("<div/>",{class:"form-group row pl-3 mb-0",html:[$("<b/>",{class:"col-sm-6 col-form-label p-0",text:"Passport Number"}),$("<div/>",{class:"col p-0",text:e.data.customer.passport_number})]}),$("<div/>",{class:"form-group row pl-3 mb-0",html:[$("<b/>",{class:"col-sm-6 col-form-label p-0",text:"Passport Expiry Date"}),$("<div/>",{class:"col p-0",text:e.data.customer.passport_expiry_date})]}),$("<div/>",{class:"Not Applicable"==e.data.customer.applicant_type||null==e.data.customer.applicant_type?"d-none":"form-group row pl-3 mb-0",html:[$("<b/>",{class:"col-sm-6 col-form-label p-0",text:"Applicant Type"}),$("<div/>",{class:"col p-0",text:e.data.customer.applicant_type})]}),$("<div/>",{class:"Not Applicable"==e.data.customer.applicant_type||null==e.data.customer.applicant_type?"d-none":"form-group row pl-3 mb-0",html:[$("<b/>",{class:"col-sm-6 col-form-label  p-0",text:a[e.data.customer.applicant_type]}),$("<div/>",{class:"col p-0",text:e.data.customer.client_id_reference_number})]}),$("<div/>",{class:"Not Applicable"==e.data.customer.applicant_type||null==e.data.customer.applicant_type?"d-none":"form-group row pl-3 mb-0",html:[$("<b/>",{class:"col-sm-6 col-form-label  p-0",text:"Visa Type"}),$("<div/>",{class:"col p-0",text:e.data.customer.visa_type})]}),$("<div/>",{class:"Not Applicable"==e.data.customer.applicant_type||null==e.data.customer.applicant_type?"d-none":"form-group row pl-3 mb-0",html:[$("<b/>",{class:"col-sm-6 col-form-label  p-0",text:"Visa Category"}),$("<div/>",{class:"col p-0",text:e.data.customer.visa_category})]}),$("<button/>",{class:null==e.data.proof_of_payment?"d-none":"btn btn-sm btn-info mb-2",text:"View proof of payment",type:"button","data-toggle":"view-image-modal","data-href":GlobalVariables.baseUrl+"/storage/uploads/"+e.data.proof_of_payment,target:"_blank"}),$("<br/>"),$("<button/>",{class:null==e.data.proof_of_identity?"d-none":"btn btn-sm btn-info",text:"View proof of identity",type:"button","data-toggle":"view-image-modal","data-href":GlobalVariables.baseUrl+"/storage/uploads/"+e.data.proof_of_identity,target:"_blank"}),$("<hr/>"),$("<div/>",{class:"d-flex justify-content-center",html:[$("<button/>",{class:"close-popover btn btn-outline-secondary mr-2",html:[$("<i/>",{class:"fas fa-ban mr-2"}),$("<span/>",{text:EALang.close})]}),$("<button/>",{class:"delete-popover btn btn-outline-secondary "+r,html:[$("<i/>",{class:"fas fa-trash-alt mr-2"}),$("<span/>",{text:EALang.delete})]}),$("<button/>",{class:"edit-popover btn btn-primary "+i,html:[$("<i/>",{class:"fas fa-edit mr-2"}),$("<span/>",{text:EALang.edit})]})]})]})}$(t.target).popover({placement:"top",title:e.title,content:n,html:!0,container:"#calendar",trigger:"manual"}),a=e,$(t.target).popover("toggle"),$(".popover").length>0&&$(".popover").position().top<200&&$(".popover").css("top","200px")}function l(e,a,t){if(!1===GlobalVariables.user.privileges.appointments.edit)return t(),void Backend.displayNotification(EALang.no_privileges_edit_appointments);var n,i=$("#calendar");if($("#notification").is(":visible")&&$("#notification").hide("bind"),!1===Boolean(Number(e.data.is_unavailable))){e.data.end_datetime=Date.parseExact(e.data.end_datetime,"yyyy-MM-dd HH:mm:ss").add({days:a.days(),hours:a.hours(),minutes:a.minutes()}).toString("yyyy-MM-dd HH:mm:ss");var s=GeneralFunctions.clone(e.data);delete s.customer,delete s.provider,delete s.service,n=function(){Backend.displayNotification(EALang.appointment_updated,[{label:EALang.undo,function:function(){s.end_datetime=e.data.end_datetime=Date.parseExact(s.end_datetime,"yyyy-MM-dd HH:mm:ss").add({days:-a.days(),hours:-a.hours(),minutes:-a.minutes()}).toString("yyyy-MM-dd HH:mm:ss");var n=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_save_appointment",i={csrfToken:GlobalVariables.csrfToken,appointment_data:JSON.stringify(s)};$.post(n,i).done((function(){$("#notification").hide("blind")})),t()}}]),$("#footer").css("position","static"),i.fullCalendar("updateEvent",e)},BackendCalendarApi.saveAppointment(s,null,n)}else{var r={id:e.data.id,start_datetime:e.start.format("YYYY-MM-DD HH:mm:ss"),end_datetime:e.end.format("YYYY-MM-DD HH:mm:ss"),id_users_provider:e.data.id_users_provider};e.data.end_datetime=r.end_datetime,n=function(){Backend.displayNotification(EALang.unavailable_updated,[{label:EALang.undo,function:function(){r.end_datetime=e.data.end_datetime=Date.parseExact(r.end_datetime,"yyyy-MM-dd HH:mm:ss").add({minutes:-a.minutes()}).toString("yyyy-MM-dd HH:mm:ss");var n=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_save_unavailable",i={csrfToken:GlobalVariables.csrfToken,unavailable:JSON.stringify(r)};$.post(n,i).done((function(){$("#notification").hide("blind")})),t()}}]),$("#footer").css("position","static"),i.fullCalendar("updateEvent",e)},BackendCalendarApi.saveUnavailable(r,n,null)}}function o(){$("#calendar").fullCalendar("option","height",i())}function d(e){e.hasTime()||($("#calendar").fullCalendar("changeView","agendaDay"),$("#calendar").fullCalendar("gotoDate",e))}function c(e,a,t){if(!1===GlobalVariables.user.privileges.appointments.edit)return t(),void Backend.displayNotification(EALang.no_privileges_edit_appointments);var n;if($("#notification").is(":visible")&&$("#notification").hide("bind"),"0"===e.data.is_unavailable){var i=GeneralFunctions.clone(e.data);delete i.customer,delete i.provider,delete i.service,i.start_datetime=Date.parseExact(i.start_datetime,"yyyy-MM-dd HH:mm:ss").add({days:a.days(),hours:a.hours(),minutes:a.minutes()}).toString("yyyy-MM-dd HH:mm:ss"),i.end_datetime=Date.parseExact(i.end_datetime,"yyyy-MM-dd HH:mm:ss").add({days:a.days(),hours:a.hours(),minutes:a.minutes()}).toString("yyyy-MM-dd HH:mm:ss"),e.data.start_datetime=i.start_datetime,e.data.end_datetime=i.end_datetime,n=function(){Backend.displayNotification(EALang.appointment_updated,[{label:EALang.undo,function:function(){i.start_datetime=Date.parseExact(i.start_datetime,"yyyy-MM-dd HH:mm:ss").add({days:-a.days(),hours:-a.hours(),minutes:-a.minutes()}).toString("yyyy-MM-dd HH:mm:ss"),i.end_datetime=Date.parseExact(i.end_datetime,"yyyy-MM-dd HH:mm:ss").add({days:-a.days(),hours:-a.hours(),minutes:-a.minutes()}).toString("yyyy-MM-dd HH:mm:ss"),e.data.start_datetime=i.start_datetime,e.data.end_datetime=i.end_datetime;var n=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_save_appointment",s={csrfToken:GlobalVariables.csrfToken,appointment_data:JSON.stringify(i)};$.post(n,s).done((function(){$("#notification").hide("blind")})),t()}}]),$("#footer").css("position","static")},BackendCalendarApi.saveAppointment(i,null,n)}else{var s={id:e.data.id,start_datetime:e.start.format("YYYY-MM-DD HH:mm:ss"),end_datetime:e.end.format("YYYY-MM-DD HH:mm:ss"),id_users_provider:e.data.id_users_provider};n=function(){Backend.displayNotification(EALang.unavailable_updated,[{label:EALang.undo,function:function(){s.start_datetime=Date.parseExact(s.start_datetime,"yyyy-MM-dd HH:mm:ss").add({days:-a.days(),minutes:-a.minutes()}).toString("yyyy-MM-dd HH:mm:ss"),s.end_datetime=Date.parseExact(s.end_datetime,"yyyy-MM-dd HH:mm:ss").add({days:-a.days(),minutes:-a.minutes()}).toString("yyyy-MM-dd HH:mm:ss"),e.data.start_datetime=s.start_datetime,e.data.end_datetime=s.end_datetime;var n=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_save_unavailable",i={csrfToken:GlobalVariables.csrfToken,unavailable:JSON.stringify(s)};$.post(n,i).done((function(){$("#notification").hide("blind")})),t()}}]),$("#footer").css("position","static")},BackendCalendarApi.saveUnavailable(s,n)}}function m(){null!==$("#select-filter-item").val()&&(b($("#calendar"),$("#select-filter-item").val(),$("#select-filter-item option:selected").attr("type"),$("#calendar").fullCalendar("getView").start,$("#calendar").fullCalendar("getView").end),$(window).trigger("resize"),$(".close-popover").each((function(e,a){$(a).parents(".popover").popover("dispose")})),$(".fv-events").each((function(e,a){$(a).popover()})))}function p(){$(".fc-custom").each((function(e,a){var t=$(a).find(".fc-event-title").text();$(a).find(".fc-event-title").html(t);var n=$(a).find(".fc-event-time").text();$(a).find(".fc-event-time").html(n)}))}function b(e,a,n,i,s){var r=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_get_calendar_appointments",l={csrfToken:GlobalVariables.csrfToken,record_id:a,start_date:i.format("YYYY-MM-DD"),end_date:s.format("YYYY-MM-DD"),filter_type:n};$("#loading").css("visibility","hidden");var o=[];return $.post(r,l).done((function(e){$("#calendar").fullCalendar("removeEvents");e.appointments.forEach((function(e){var a={id:e.id,title:e.customer.first_name+" "+e.customer.last_name,start:moment(e.start_datetime),end:moment(e.end_datetime),allDay:!1,data:e};o.push(a)})),e.unavailables.forEach((function(e){var a=e.notes?" - "+e.notes:"";e.notes&&e.notes.length>30&&(a=e.notes.substring(0,30)+"...");var t={title:EALang.unavailable+a,start:moment(e.start_datetime),end:moment(e.end_datetime),allDay:!1,color:"#879DB4",editable:!0,className:"fc-unavailable fc-custom",data:e};o.push(t)}));var i=$("#calendar").fullCalendar("getView");if(n===t&&"month"!==i.name){var s=GlobalVariables.availableProviders.find((function(e){return Number(e.id)===Number(a)}));if(!s)throw new Error("Provider was not found.");var r,l,d,c,m,p,b,u,f,v,g,y,_,h,E,x=JSON.parse(s.settings.working_plan),A=JSON.parse(s.settings.working_plan_exceptions),k=GeneralFunctions.getWeekDayId(GlobalVariables.firstWeekday),D=GeneralFunctions.sortWeekDictionary(x,k);switch(i.name){case"agendaDay":if(u=parseInt(i.start.format("d")),f=GeneralFunctions.getWeekdayName(u),v=i.start.clone().format("YYYY-MM-DD"),A&&A[v]&&(D[f]=A[v],p=v+" "+D[f].start,b=v+" "+D[f].end,g={title:EALang.working_plan_exception,start:moment(p,"YYYY-MM-DD HH:mm",!0),end:moment(b,"YYYY-MM-DD HH:mm",!0).add(1,"day"),allDay:!0,color:"#879DB4",editable:!1,className:"fc-working-plan-exception fc-custom",data:{date:v,workingPlanException:A[v],provider:s}},o.push(g)),null===D[f])return r={title:EALang.not_working,start:i.intervalStart.clone(),end:i.intervalEnd.clone(),allDay:!1,color:"#BEBEBE",editable:!1,className:"fc-unavailable"},void o.push(r);if(l=moment(i.start.format("YYYY-MM-DD")+" 00:00:00"),y=D[f].start.split(":"),(h=l.clone()).hour(parseInt(y[0])),h.minute(parseInt(y[1])),l<h){var M={title:EALang.not_working,start:l,end:h,allDay:!1,color:"#BEBEBE",editable:!1,className:"fc-unavailable"};o.push(M)}if(d=moment(i.end.format("YYYY-MM-DD")+" 00:00:00"),_=D[f].end.split(":"),(E=l.clone()).hour(parseInt(_[0])),E.minute(parseInt(_[1])),d>E){var L={title:EALang.not_working,start:E,end:d,allDay:!1,color:"#BEBEBE",editable:!1,className:"fc-unavailable"};o.push(L)}D[f].breaks.forEach((function(e){var a=e.start.split(":");(c=l.clone()).hour(parseInt(a[0])),c.minute(parseInt(a[1]));var t=e.end.split(":");(m=l.clone()).hour(parseInt(t[0])),m.minute(parseInt(t[1]));var n={title:EALang.break,start:c,end:m,allDay:!1,color:"#BEBEBE",editable:!1,className:"fc-unavailable fc-break"};o.push(n)}));break;case"agendaWeek":for(var Y=i.start.clone();Y<i.end;)u=parseInt(Y.format("d")),f=GeneralFunctions.getWeekdayName(u),v=Y.format("YYYY-MM-DD"),A&&A[v]&&(D[f]=A[v],p=v+" "+D[f].start,b=v+" "+D[f].end,g={title:EALang.working_plan_exception,start:moment(p,"YYYY-MM-DD HH:mm",!0),end:moment(b,"YYYY-MM-DD HH:mm",!0).add(1,"day"),allDay:!0,color:"#879DB4",editable:!1,className:"fc-working-plan-exception fc-custom",data:{date:v,workingPlanException:A[v],provider:s}},o.push(g)),null!==D[f]?(y=D[f].start.split(":"),(h=Y.clone()).hour(parseInt(y[0])),h.minute(parseInt(y[1])),Y<h&&(r={title:EALang.not_working,start:Y.clone(),end:moment(Y.format("YYYY-MM-DD")+" "+D[f].start+":00"),allDay:!1,color:"#BEBEBE",editable:!1,className:"fc-unavailable"},o.push(r)),_=D[f].end.split(":"),(E=Y.clone()).hour(parseInt(_[0])),E.minute(parseInt(_[1])),i.end>E&&(r={title:EALang.not_working,start:moment(Y.format("YYYY-MM-DD")+" "+D[f].end+":00"),end:Y.clone().add(1,"day"),allDay:!1,color:"#BEBEBE",editable:!1,className:"fc-unavailable"},o.push(r)),D[f].breaks.forEach((function(e){var a=e.start.split(":");(c=Y.clone()).hour(parseInt(a[0])),c.minute(parseInt(a[1]));var t=e.end.split(":");(m=Y.clone()).hour(parseInt(t[0])),m.minute(parseInt(t[1]));var n={title:EALang.break,start:moment(Y.format("YYYY-MM-DD")+" "+e.start),end:moment(Y.format("YYYY-MM-DD")+" "+e.end),allDay:!1,color:"#BEBEBE",editable:!1,className:"fc-unavailable fc-break"};o.push(n)})),Y.add(1,"day")):(r={title:EALang.not_working,start:Y.clone(),end:Y.clone().add(1,"day"),allDay:!1,color:"#BEBEBE",editable:!1,className:"fc-unavailable"},o.push(r),Y.add(1,"day"))}}})).always((function(){$("#loading").css("visibility",""),e.fullCalendar("addEventSource",o)}))}e.initialize=function(){var e={};switch(GlobalVariables.dateFormat){case"DMY":e="ddd D/M";break;case"MDY":case"YMD":e="ddd M/D";break;default:throw new Error("Invalid date format setting provided!",GlobalVariables.dateFormat)}var s="",u="";switch(GlobalVariables.timeFormat){case"military":s="H:mm",u="H(:mm)";break;case"regular":s="h:mm a",u="h(:mm) a";break;default:throw new Error("Invalid time format setting provided!",GlobalVariables.timeFormat)}var f,v=window.innerWidth<468?"agendaDay":"agendaWeek",g=GlobalVariables.firstWeekday,y=GeneralFunctions.getWeekDayId(g);if($("#calendar").fullCalendar({defaultView:v,height:i(),editable:!0,firstDay:y,slotDuration:"00:06:00",snapDuration:"00:06:00",slotLabelInterval:"01:00",timeFormat:s,slotLabelFormat:u,allDayText:EALang.all_day,columnFormat:e,header:{left:"prev,next today",center:"title",right:"agendaDay,agendaWeek,month"},selectable:!0,selectHelper:!0,select:function(e,a){if(e.hasTime()&&a.hasTime()){var t;if($("#insert-appointment").trigger("click"),$("#select-filter-item option:selected").attr("type")===n)t=GlobalVariables.availableServices.find((function(e){return Number(e.id)===Number($("#select-filter-item").val())})),$("#select-service").val(t.id).trigger("change");else{var i=GlobalVariables.availableProviders.find((function(e){return Number(e.id)===Number($("#select-filter-item").val())}));(t=GlobalVariables.availableServices.find((function(e){return-1!==i.services.indexOf(e.id)})))&&$("#select-service").val(t.id),$("#select-service").val()||$("#select-service option:first").prop("selected",!0),$("#select-service").trigger("change"),i&&$("#select-provider").val(i.id),$("#select-provider").val()||$("#select-provider option:first").prop("selected",!0),$("#select-provider").trigger("change")}return $("#start-datetime").datepicker("setDate",new Date(e.format("YYYY/MM/DD HH:mm:ss"))),$("#end-datetime").datepicker("setDate",new Date(a.format("YYYY/MM/DD HH:mm:ss"))),!1}},monthNames:[EALang.january,EALang.february,EALang.march,EALang.april,EALang.may,EALang.june,EALang.july,EALang.august,EALang.september,EALang.october,EALang.november,EALang.december],monthNamesShort:[EALang.january.substr(0,3),EALang.february.substr(0,3),EALang.march.substr(0,3),EALang.april.substr(0,3),EALang.may.substr(0,3),EALang.june.substr(0,3),EALang.july.substr(0,3),EALang.august.substr(0,3),EALang.september.substr(0,3),EALang.october.substr(0,3),EALang.november.substr(0,3),EALang.december.substr(0,3)],dayNames:[EALang.sunday,EALang.monday,EALang.tuesday,EALang.wednesday,EALang.thursday,EALang.friday,EALang.saturday],dayNamesShort:[EALang.sunday.substr(0,3),EALang.monday.substr(0,3),EALang.tuesday.substr(0,3),EALang.wednesday.substr(0,3),EALang.thursday.substr(0,3),EALang.friday.substr(0,3),EALang.saturday.substr(0,3)],dayNamesMin:[EALang.sunday.substr(0,2),EALang.monday.substr(0,2),EALang.tuesday.substr(0,2),EALang.wednesday.substr(0,2),EALang.thursday.substr(0,2),EALang.friday.substr(0,2),EALang.saturday.substr(0,2)],buttonText:{today:EALang.today,day:EALang.day,week:EALang.week,month:EALang.month},windowResize:o,viewRender:m,dayClick:d,eventClick:r,eventResize:l,eventDrop:c,eventAfterAllRender:p}),o(),GlobalVariables.availableProviders.length>0&&$("<optgroup/>",{label:EALang.providers,type:"providers-group",html:GlobalVariables.availableProviders.map((function(e){var a="1"===e.settings.google_sync?"true":"false";return $("<option/>",{value:e.id,type:t,"google-sync":a,text:e.first_name+" "+e.last_name})}))}).appendTo("#select-filter-item"),GlobalVariables.availableServices.length>0&&$("<optgroup/>",{label:EALang.services,type:"services-group",html:GlobalVariables.availableServices.map((function(e){return $("<option/>",{value:e.id,type:n,text:e.name})}))}).appendTo("#select-filter-item"),GlobalVariables.user.role_slug===Backend.DB_SLUG_PROVIDER&&($("#select-filter-item optgroup:eq(0)").find('option[value="'+GlobalVariables.user.id+'"]').prop("selected",!0),$("#select-filter-item").prop("disabled",!0)),GlobalVariables.user.role_slug===Backend.DB_SLUG_SECRETARY&&($("#select-filter-item optgroup:eq(1)").remove(),$('#select-filter-item option[type="provider"]').each((function(e,a){GlobalVariables.secretaryProviders.find((function(e){return Number($(a).val())===Number(e)}))||$(a).remove()})),$('#select-filter-item option[type="provider"]').length||$('#select-filter-item optgroup[type="providers-group"]').remove()),f=$("#calendar-page"),$("#reload-appointments").on("click",(function(){var e=$("#calendar").fullCalendar("getView");b($("#calendar"),$("#select-filter-item").val(),$("#select-filter-item").find("option:selected").attr("type"),e.start,e.end)})),f.on("click",".close-popover",(function(){$(this).parents(".popover").popover("dispose")})),f.on("click",".edit-popover",(function(){var e,t,n;if($(this).parents(".popover").popover("dispose"),a.data.workingPlanException){var i=a.data.date,s=a.data.workingPlanException,r=a.data.provider;WorkingPlanExceptionsModal.edit(i,s).done((function(e,a){BackendCalendarApi.saveWorkingPlanException(e,a,r.id,(function(){Backend.displayNotification(EALang.working_plan_exception_saved);var t=JSON.parse(r.settings.working_plan_exceptions)||{};for(var n in t[e]=a,GlobalVariables.availableProviders){var i=GlobalVariables.availableProviders[n];if(Number(i.id)===Number(r.id)){i.settings.working_plan_exceptions=JSON.stringify(t);break}}$("#select-filter-item").trigger("change")}),null)}))}else if("0"===a.data.is_unavailable){var l=a.data;e=$("#manage-appointment"),BackendCalendarAppointmentsModal.resetAppointmentDialog(),e.find(".modal-header h3").text(EALang.edit_appointment_title),e.find("#appointment-id").val(l.id),e.find("#select-service").val(l.id_services).trigger("change"),e.find("#select-provider").val(l.id_users_provider),t=Date.parseExact(l.start_datetime,"yyyy-MM-dd HH:mm:ss"),e.find("#start-datetime").datetimepicker("setDate",t),n=Date.parseExact(l.end_datetime,"yyyy-MM-dd HH:mm:ss"),e.find("#end-datetime").datetimepicker("setDate",n);var o=l.customer;e.find("#customer-id").val(l.id_users_customer),e.find("#first-name").val(o.first_name),e.find("#last-name").val(o.last_name),e.find("#email").val(o.email),e.find("#phone-number").val(o.phone_number),e.find("#address").val(o.address),e.find("#city").val(o.city),e.find("#zip-code").val(o.zip_code),e.find("#appointment-location").val(l.location),e.find("#appointment-notes").val(l.notes),e.find("#customer-notes").val(o.notes),e.find('input[name="sex"]').prop("checked",!1),e.find("#sex-"+o.sex).prop("checked",!0),e.find("#birth-date").val(o.birth_date),e.find("#passport-number").val(o.passport_number),e.find("#passport-expiry-date").val(o.passport_expiry_date);let i=o.applicant_type,s="ID #";switch(e.find(".client-id-reference-number-container").addClass("d-none"),e.find(".visa-category-container").addClass("d-none"),e.find(".visa-type-container").addClass("d-none"),e.find(".canada-applicants-info").addClass("d-none"),e.find(".australia-applicants-info").addClass("d-none"),e.find(".new-zealand-applicants-info").addClass("d-none"),i){case"CANADA":s="IME/UCCI #",e.find(".canada-applicants-info").removeClass("d-none"),e.find(".client-id-reference-number-container").removeClass("d-none"),e.find(".visa-category-container").removeClass("d-none"),e.find(".visa-type-container").removeClass("d-none");break;case"AUSTRALIA":s="HAP ID",e.find(".australia-applicants-info").removeClass("d-none"),e.find(".client-id-reference-number-container").removeClass("d-none");break;case"NEW ZEALAND":s="NZER/NZHR",e.find(".new-zealand-applicants-info").removeClass("d-none"),e.find(".client-id-reference-number-container").removeClass("d-none"),e.find(".visa-category-container").removeClass("d-none"),e.find(".visa-type-container").removeClass("d-none");break;default:e.find(".client-id-reference-number-container").addClass("d-none"),e.find(".visa-category-container").addClass("d-none"),e.find(".visa-type-container").addClass("d-none")}e.find('label[for="client-id-reference-number"]').text(s),e.find("#applicant-type").val(i),e.find("#client-id-reference-number").val(o.client_id_reference_number),e.find("#visa-category").val(o.visa_category),e.find("#visa-type").val(o.visa_type),e.modal("show")}else{var d=a.data;d.start_datetime=a.start.format("YYYY-MM-DD HH:mm:ss"),t=Date.parseExact(d.start_datetime,"yyyy-MM-dd HH:mm:ss"),d.end_datetime=a.end.format("YYYY-MM-DD HH:mm:ss"),n=Date.parseExact(d.end_datetime,"yyyy-MM-dd HH:mm:ss"),e=$("#manage-unavailable"),BackendCalendarUnavailabilityEventsModal.resetUnavailableDialog(),e.find(".modal-header h3").text("Edit Unavailable Period"),e.find("#unavailable-start").datetimepicker("setDate",t),e.find("#unavailable-id").val(d.id),e.find("#unavailable-provider").val(d.id_users_provider),e.find("#unavailable-end").datetimepicker("setDate",n),e.find("#unavailable-notes").val(d.notes),e.modal("show")}})),f.on("click",".delete-popover",(function(){var e,t;if($(this).parents(".popover").popover("dispose"),a.data.workingPlanException){var n=$("#select-filter-item").val(),i=GlobalVariables.availableProviders.find((function(e){return Number(e.id)===Number(n)}));if(!i)throw new Error("Provider could not be found: "+n);var s=a.start.format("YYYY-MM-DD");BackendCalendarApi.deleteWorkingPlanException(s,n,(function(){Backend.displayNotification(EALang.working_plan_exception_deleted);var e=JSON.parse(i.settings.working_plan_exceptions)||{};for(var a in delete e[s],GlobalVariables.availableProviders){var t=GlobalVariables.availableProviders[a];if(Number(t.id)===Number(n)){t.settings.working_plan_exceptions=JSON.stringify(e);break}}$("#select-filter-item").trigger("change")}))}else if("0"===a.data.is_unavailable){var r=[{text:EALang.cancel,click:function(){$("#message-box").dialog("close")}},{text:"OK",click:function(){e=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_delete_appointment",t={csrfToken:GlobalVariables.csrfToken,appointment_id:a.data.id,delete_reason:$("#delete-reason").val()},$.post(e,t).done((function(){$("#message-box").dialog("close"),$("#select-filter-item").trigger("change")}))}}];GeneralFunctions.displayMessageBox(EALang.delete_appointment_title,EALang.write_appointment_removal_reason,r),$("<textarea/>",{class:"form-control w-100",id:"delete-reason",rows:"3"}).appendTo("#message-box")}else e=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_delete_unavailable",t={csrfToken:GlobalVariables.csrfToken,unavailable_id:a.data.id},$.post(e,t).done((function(){$("#message-box").dialog("close"),$("#select-filter-item").trigger("change")}))})),$("#select-filter-item").on("change",(function(){if($("#select-filter-item option:selected").attr("type")===n)$("#google-sync, #enable-sync, #insert-appointment, #insert-dropdown").prop("disabled",!0),$("#calendar").fullCalendar("option",{selectable:!1,editable:!1});else{$("#google-sync, #enable-sync, #insert-appointment, #insert-dropdown").prop("disabled",!1),$("#calendar").fullCalendar("option",{selectable:!0,editable:!0});var e=$("#select-filter-item").val(),a=GlobalVariables.availableProviders.find((function(a){return Number(a.id)===Number(e)}));a&&a.timezone&&$(".provider-timezone").text(GlobalVariables.timezones[a.timezone]),"true"===$("#select-filter-item option:selected").attr("google-sync")?($("#enable-sync").removeClass("btn-light").addClass("btn-secondary enabled"),$("#enable-sync span").text(EALang.disable_sync),$("#google-sync").prop("disabled",!1)):($("#enable-sync").removeClass("btn-secondary enabled").addClass("btn-light"),$("#enable-sync span").text(EALang.enable_sync),$("#google-sync").prop("disabled",!0))}})),$("#select-filter-item").trigger("change"),GlobalVariables.editAppointment){var _=$("#manage-appointment"),h=GlobalVariables.editAppointment;BackendCalendarAppointmentsModal.resetAppointmentDialog(),_.find(".modal-header h3").text(EALang.edit_appointment_title),_.find("#appointment-id").val(h.id),_.find("#select-service").val(h.id_services).trigger("change"),_.find("#select-provider").val(h.id_users_provider);var E=Date.parseExact(h.start_datetime,"yyyy-MM-dd HH:mm:ss");_.find("#start-datetime").datetimepicker("setDate",E);var x=Date.parseExact(h.end_datetime,"yyyy-MM-dd HH:mm:ss");_.find("#end-datetime").datetimepicker("setDate",x);var A=h.customer;_.find("#customer-id").val(h.id_users_customer),_.find("#first-name").val(A.first_name),_.find("#last-name").val(A.last_name),_.find("#email").val(A.email),_.find("#phone-number").val(A.phone_number),_.find("#address").val(A.address),_.find("#city").val(A.city),_.find("#zip-code").val(A.zip_code),_.find("#appointment-location").val(h.location),_.find("#appointment-notes").val(h.notes),_.find("#customer-notes").val(A.notes),_.modal("show")}$("#select-filter-item option").length||$("#calendar-actions button").prop("disabled",!0),window.innerHeight<700&&$("#footer").css("position","static");var k=$("#calendar"),D=$("#select-filter-item");setInterval((function(){var e=k.fullCalendar("getView");b(k,D.val(),D.find("option:selected").attr("type"),e.start,e.end)}),6e4)}}(window.BackendCalendarDefaultView);