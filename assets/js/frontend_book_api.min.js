window.FrontendBookApi=window.FrontendBookApi||{},function(e){"use strict";var a,t,n=!1,o=["January","February","March","April","May","June","July","August","September","October","November","December"];function r(e,a,t){t=t||!1,n=!0;var o=Date.parse(a),r=moment(o).daysInMonth();if(t&&!GlobalVariables.manageMode)for(var i=1;i<=r;i++){var s=new Date(o.getFullYear(),o.getMonth(),i);if(-1===e.indexOf(s.toString("yyyy-MM-dd"))){$("#select-date").datepicker("setDate",s),FrontendBookApi.getAvailableHours(s.toString("yyyy-MM-dd"));break}}e.length===r&&$("#available-hours").text(EALang.no_available_hours),$("#select-date .ui-datepicker-calendar td:not(.ui-datepicker-other-month)").each(function(a,t){o.set({day:a+1}),-1!==e.indexOf(o.toString("yyyy-MM-dd"))&&$(t).addClass("ui-datepicker-unselectable ui-state-disabled")}),n=!1}e.getAvailableHours=function(e){$("#available-hours").empty();var a=Date.parse(e);$("#available-hours-loading-info").text("Loading available Hours for "+o[a.getMonth()]+" "+a.getDate()+". Please Wait...");var t=$("#select-service").val(),n=15,r=GlobalVariables.availableServices.find(function(e){return Number(e.id)===Number(t)});r&&(n=r.duration);var i=FrontendBook.manageMode?GlobalVariables.appointmentData.id:null,s=GlobalVariables.baseUrl+"/index.php/appointments/ajax_get_available_hours",l={csrfToken:GlobalVariables.csrfToken,service_id:$("#select-service").val(),provider_id:$("#select-provider").val(),selected_date:e,service_duration:n,manage_mode:FrontendBook.manageMode,appointment_id:i};$.post(s,l).done(function(a){if($("#available-hours-loading-info").text(""),a.length>0){var n=$("#select-provider").val();if("any-provider"===n){for(var o of GlobalVariables.availableProviders)if(-1!==o.services.indexOf(t)){n=o.id;break}}var r=GlobalVariables.availableProviders.find(function(e){return Number(n)===Number(e.id)});if(!r)throw Error("Could not find provider.");var i=r.timezone,s=$("#select-timezone").val(),l="regular"===GlobalVariables.timeFormat?"h:mm a":"HH:mm";a.forEach(function(a){var t=moment.tz(e+" "+a+":00",i).tz(s);t.format("YYYY-MM-DD")===e&&$("#available-hours").append($("<button/>",{class:"btn btn-outline-secondary btn-block shadow-none available-hour",data:{value:a},text:t.format(l)}))}),FrontendBook.manageMode?$(".available-hour").removeClass("selected-hour").filter(function(){return $(this).text()===Date.parseExact(GlobalVariables.appointmentData.start_datetime,"yyyy-MM-dd HH:mm:ss").toString(l)}).addClass("selected-hour"):$(".available-hour:eq(0)").addClass("selected-hour"),FrontendBook.updateConfirmFrame()}$(".available-hour").length||$("#available-hours").text(EALang.no_available_hours)})},e.registerAppointment=function(){var e=$(".captcha-text");if(e.length>0&&(e.closest(".form-group").removeClass("has-error"),""===e.val())){e.closest(".form-group").addClass("has-error");return}var a=new FormData,t=$("#proof-of-payment")[0],n=$("#proof-of-identity")[0];a.append("proof_of_payment_file",t.files[0]),a.append("proof_of_identity_file",n.files[0]),a.append("post_data",$('input[name="post_data"]').val()),a.append("post_data_json",JSON.parse($('input[name="post_data"]').val())),a.append("csrfToken",GlobalVariables.csrfToken),e.length>0&&a.append("captcha",e.val()),GlobalVariables.manageMode&&a.append("exclude_appointment_id",GlobalVariables.appointmentData.id);var o=GlobalVariables.baseUrl+"/index.php/appointments/ajax_register_appointment",r=$("<div/>");$.ajax({url:o,method:"post",data:a,contentType:!1,processData:!1,beforeSend:function(e,a){r.appendTo("body").css({background:"white",position:"fixed",top:"0",left:"0",height:"100vh",width:"100vw",opacity:"0.5"})}}).done(function(a){if(!1===a.captcha_verification)return $("#captcha-hint").text(EALang.captcha_is_wrong).fadeTo(400,1),setTimeout(function(){$("#captcha-hint").fadeTo(400,0)},3e3),$(".captcha-title button").trigger("click"),e.closest(".form-group").addClass("has-error"),!1;window.location.href=GlobalVariables.baseUrl+"/index.php/appointments/book_success/"+a.appointment_hash}).fail(function(e,a,t){$(".captcha-title button").trigger("click")}).always(function(){r.remove()})},e.getUnavailableDates=function(e,i,s){if(!n&&e&&i){var l=FrontendBook.manageMode?GlobalVariables.appointmentData.id:null,d=GlobalVariables.baseUrl+"/index.php/appointments/ajax_get_unavailable_dates",p={provider_id:e,service_id:i,selected_date:encodeURIComponent(s),csrfToken:GlobalVariables.csrfToken,manage_mode:FrontendBook.manageMode,appointment_id:l};$.ajax({url:d,type:"GET",data:p,dataType:"json",beforeSend:function(){$("#calendar-loader").find(".overlay").removeClass("d-none");var e=Date.parse(s);$("#available-hours").text("Loading available Dates for the month of "+o[e.getMonth()]+". Please Wait...")},success:function(){$("#calendar-loader").find(".overlay").addClass("d-none")}}).done(function(e){$("#calendar-loader").find(".overlay").addClass("d-none"),a=e,t=s,r(e,s,!0)})}},e.applyPreviousUnavailableDates=function(){r(a,t)},e.saveConsent=function(e){var a=GlobalVariables.baseUrl+"/index.php/consents/ajax_save_consent",t={csrfToken:GlobalVariables.csrfToken,consent:e};$.post(a,t)},e.deletePersonalInformation=function(e){var a=GlobalVariables.baseUrl+"/index.php/privacy/ajax_delete_personal_information",t={csrfToken:GlobalVariables.csrfToken,customer_token:e};$.post(a,t).done(function(){window.location.href=GlobalVariables.baseUrl})}}(window.FrontendBookApi);